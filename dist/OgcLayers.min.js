const ogcLayer={_layerBounds:null,metadata:{},styleMetadata:{},_tileUrl:null,_getMetadata:function(){const t=this;return new Promise(function(e){fetch(t._url+"?f=json").then(function(t){t.json().then(function(t){e(t)})})})},_setLayerBounds:function(){const t=this.metadata.extent.spatial.bbox;this._layerBounds=L.latLngBounds(L.latLng(t[0][1],t[0][0]),L.latLng(t[0][3],t[0][2]))},_checkIfTileOverlapsExtent:function(t){return!(null!==this._layerBounds&&!t.intersects(this._layerBounds))},_tileMatrixFields:["tileMatrixSetDefinition","tileMatrixSetURI","wellKnownScaleSet"],_validWebMercatorHits:["WebMercatorQuad","GoogleMapsCompatible"],_findWebMercatorTilesetMatrix:function(t){for(var e=0;e<t.length;e++)for(var i=t[e],n=0;n<this._tileMatrixFields.length;n++)for(var s=this._tileMatrixFields[n],a=0;a<this._validWebMercatorHits.length;a++){var r=this._validWebMercatorHits[a];if(i[s]&&i[s].indexOf(r)>-1)for(var l=0;l<i.links.length;l++)if(i.links[l].rel.indexOf("tileset")>-1){var o=i.links[l].href.split("?")[0];if("/"!==o[0])return o;var c=new URL(this._url);return c.origin+o}}},_getStylesMetadata:function(){const t=this;return new Promise(function(e){fetch(t._url+"/styles?f=json").then(function(t){t.json().then(function(t){e(t)})})})},_findMapUrlFromStyles:function(t){for(var e=0;e<t.length;e++){var i=t[e];if(i.id===this.options.style)for(var n=0;n<i.links.length;n++){var s=i.links[n];if("map"===s.rel)return s.href}}return null}};L.OgcMapsLayer=L.TileLayer.extend({defaultOgcMapsParams:{f:"image/jpg",transparent:!0,width:256,height:256,crs:"CRS84"},options:{style:"default"},initialize:function(t,e){this._url=t;var i=L.Util.extend({},this.defaultOgcMapsParams);for(var n in e)n in this.options||(i[n]=e[n]);e=L.Util.setOptions(this,e);var s=e.detectRetina&&retina?2:1,a=this.getTileSize();i.width=a.x*s,i.height=a.y*s,this.ogcMapsParams=i,L.Util.extend(this,ogcLayer);var r=this;this._getMetadata().then(function(t){r.metadata=t,r.metadata&&r._setLayerBounds()}),this._getStylesMetadata().then(function(t){r.styleMetadata=t,r.styleMetadata&&"default"!==r.options.style&&(r._tileUrl=r._findMapUrlFromStyles(r.styleMetadata.styles),r.redraw())})},onAdd:function(t){this._crs=this.options.crs||t.options.crs,L.TileLayer.prototype.onAdd.call(this,t)},getTileUrl:function(t){const e=this._tileCoordsToBounds(t);if(!this._checkIfTileOverlapsExtent(e))return"";const i=L.Util.getParamString(this.ogcMapsParams);return(null!==this._tileUrl?this._tileUrl:this._url+"/map")+i+"&bbox="+e.toBBoxString()},setParams:function(t,e){return L.Util.extend(this.ogcMapsParams,t),e||this.redraw(),this},_getStylesMetadata:function(){const t=this;return new Promise(function(e){fetch(t._url+"/styles?f=json").then(function(t){t.json().then(function(t){e(t)})})})}}),L.ogcMapsLayer=function(t,e){return new L.OgcMapsLayer(t,e)},L.OgcTilesLayer=L.TileLayer.extend({options:{f:"png",style:"default"},tilesMetadata:{},initialize:function(t,e){var i=this;this._url=t,e=L.Util.setOptions(this,e),L.Util.extend(this,ogcLayer),this._getMetadata().then(function(t){i.metadata=t,i.metadata&&i._setLayerBounds()}),this._getTilesMetadata().then(function(t){i.tilesMetadata=t,i.tilesMetadata&&(i._tileUrl=i._findWebMercatorTilesetMatrix(i.tilesMetadata.tilesets),i.redraw())})},onAdd:function(t){this._crs=this.options.crs||t.options.crs,L.TileLayer.prototype.onAdd.call(this,t)},getTileUrl:function(t){if(null===this._tileUrl)return"";const e=this._tileCoordsToBounds(t);return this._checkIfTileOverlapsExtent(e)?this._tileUrl+"/"+this._getZoomForUrl()+"/"+t.y+"/"+t.x+"."+this.options.f:""},_getTilesMetadata:function(){const t=this;return new Promise(function(e){fetch(t._url+"/map/tiles?f=json").then(function(t){t.json().then(function(t){e(t)})})})}}),L.ogcTilesLayer=function(t,e){return new L.OgcTilesLayer(t,e)};