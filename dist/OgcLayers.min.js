const ogcLayer={_layerBounds:null,metadata:{},styleMetadata:{},_tileUrl:null,_getMetadata:function(){const t=this;return new Promise(function(e){fetch(t._url+"?f=json").then(function(t){t.json().then(function(t){e(t)})})})},_setLayerBounds:function(){const t=this.metadata.extent.spatial.bbox;this._layerBounds=L.latLngBounds(L.latLng(t[0][1],t[0][0]),L.latLng(t[0][3],t[0][2]))},_checkIfTileOverlapsExtent:function(t){return!(null!==this._layerBounds&&!t.intersects(this._layerBounds))},_tileMatrixFields:["tileMatrixSetDefinition","tileMatrixSetURI","wellKnownScaleSet"],_validWebMercatorHits:["WebMercatorQuad","GoogleMapsCompatible"],_cleanUrlOfParams:function(t){return t.split("?")[0]},_ensureAbsoluteUrl:function(t){return"/"!==t[0]?t:new URL(this._url).origin+t},_findWebMercatorTilesetMatrix:function(t){for(var e=0;e<t.length;e++)for(var i=t[e],s=0;s<this._tileMatrixFields.length;s++)for(var n=this._tileMatrixFields[s],a=0;a<this._validWebMercatorHits.length;a++){var l=this._validWebMercatorHits[a];if(i[n]&&i[n].indexOf(l)>-1)for(var r=0;r<i.links.length;r++)if(i.links[r].rel.indexOf("tileset")>-1){var o=this._cleanUrlOfParams(i.links[r].href);return this._ensureAbsoluteUrl(o)}}},_getStylesMetadata:function(){const t=this;return new Promise(function(e){fetch(t._url+"/styles?f=json").then(function(t){t.json().then(function(t){e(t)})})})},_findMapUrlFromStyles:function(t){for(var e=0;e<t.length;e++){var i=t[e];if(i.id===this.options.style)for(var s=0;s<i.links.length;s++){var n=i.links[s];if("map"===n.rel)return n.href}}return null}};L.OgcMapsLayer=L.TileLayer.extend({defaultOgcMapsParams:{f:"image/jpg",transparent:!0,width:256,height:256,crs:"CRS84"},options:{style:"default"},initialize:function(t,e){this._url=t;var i=L.Util.extend({},this.defaultOgcMapsParams);for(var s in e)s in this.options||(i[s]=e[s]);e=L.Util.setOptions(this,e);var n=e.detectRetina&&retina?2:1,a=this.getTileSize();i.width=a.x*n,i.height=a.y*n,this.ogcMapsParams=i,L.Util.extend(this,ogcLayer);var l=this;this._getMetadata().then(function(t){l.metadata=t,l.metadata&&l._setLayerBounds()}),this._getStylesMetadata().then(function(t){l.styleMetadata=t,l.styleMetadata&&"default"!==l.options.style&&(l._tileUrl=l._findMapUrlFromStyles(l.styleMetadata.styles),l.redraw())})},onAdd:function(t){this._crs=this.options.crs||t.options.crs,L.TileLayer.prototype.onAdd.call(this,t)},getTileUrl:function(t){const e=this._tileCoordsToBounds(t);if(!this._checkIfTileOverlapsExtent(e))return"";const i=L.Util.getParamString(this.ogcMapsParams);return("default"!==this.options.style?this._url+"/styles/"+this.options.style+"/map":this._url+"/map")+i+"&bbox="+e.toBBoxString()},setParams:function(t,e){return L.Util.extend(this.ogcMapsParams,t),e||this.redraw(),this}}),L.ogcMapsLayer=function(t,e){return new L.OgcMapsLayer(t,e)},L.OgcTilesLayer=L.TileLayer.extend({options:{f:"png",style:"default"},tilesMetadata:{},_tileBaseUrl:null,initialize:function(t,e){var i=this;this._url=t,e=L.Util.setOptions(this,e),L.Util.extend(this,ogcLayer),this._getMetadata().then(function(t){i.metadata=t,i.metadata&&(i._setLayerBounds(),i._getTileBaseUrl())})},onAdd:function(t){this._crs=this.options.crs||t.options.crs,L.TileLayer.prototype.onAdd.call(this,t)},_getTileBaseUrl:function(){if("default"===this.options.style)this._tileBaseUrl=this._findTilesUrlBaseFromLinks(this.metadata.links),this._setTileUrl();else{var t=this;this._getStylesMetadata().then(function(e){t.styleMetadata=e,t.styleMetadata&&(t.options.style=t.styleMetadata.defaultStyle?t.styleMetadata.defaultStyle:t.styleMetadata.styles[0].id,t._tileBaseUrl=t._findTilesUrlFromStyles(t.styleMetadata.styles),t._setTileUrl())})}},_setTileUrl:function(){var t=this;t._getStyledTileMetadata().then(function(e){t.tilesMetadata=e,t.tilesMetadata&&(t._tileUrl=t._findWebMercatorTilesetMatrix(t.tilesMetadata.tilesets),t.redraw())})},getTileUrl:function(t){if(null===this._tileUrl)return"";const e=this._tileCoordsToBounds(t);return this._checkIfTileOverlapsExtent(e)?this._tileUrl+"/"+this._getZoomForUrl()+"/"+t.y+"/"+t.x+"."+this.options.f:""},_getStyledTileMetadata:function(){const t=this;return new Promise(function(e){fetch(t._tileBaseUrl).then(function(t){t.json().then(function(t){e(t)})})})},_findTilesUrlFromStyles:function(t){for(var e=0;e<t.length;e++){var i=t[e];if(i.id===this.options.style)for(var s=0;s<i.links.length;s++){var n=i.links[s];if(n.rel.indexOf("tilesets")>-1){var a=this._cleanUrlOfParams(n.href);return this._ensureAbsoluteUrl(a)}}}return null},_findTilesUrlBaseFromLinks:function(t){for(var e=0;e<t.length;e++){var i=t[e];if(i.rel.indexOf("tilesets-map")>-1){var s=this._cleanUrlOfParams(i.href);return this._ensureAbsoluteUrl(s)}}return null}}),L.ogcTilesLayer=function(t,e){return new L.OgcTilesLayer(t,e)};